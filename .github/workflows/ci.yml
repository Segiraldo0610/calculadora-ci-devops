name: Java CI con Maven

# CuÃ¡ndo ejecutar este workflow
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

# Permisos necesarios
permissions:
  contents: read

jobs:
  build:
    name: Build y Test en mÃºltiples versiones de Java
    runs-on: ubuntu-latest

    strategy:
      matrix:
        java-version: ['11', '17', '21']

    steps:
      # Paso 1: Descargar el cÃ³digo del repositorio
      - name: ðŸ“¥ Checkout del cÃ³digo
        uses: actions/checkout@v4

      # Paso 2: Configurar Java JDK (usando la versiÃ³n del matrix)
      - name: â˜• Configurar JDK ${{ matrix.java-version }}
        uses: actions/setup-java@v4
        with:
          java-version: ${{ matrix.java-version }}
          distribution: 'temurin'
          cache: maven

      # Paso 3: Compilar el proyecto
      - name: ðŸ”¨ Compilar con Maven
        run: mvn clean compile

      # Paso 4: Ejecutar tests
      - name: ðŸ§ª Ejecutar tests
        run: mvn test

      # Paso 5: Generar reporte de tests (siempre se ejecuta)
      - name: ðŸ“Š Generar reporte de tests
        if: always()
        run: mvn surefire-report:report

      # Paso 6: Generar artefacto JAR
      - name: ðŸ“¦ Empaquetar aplicaciÃ³n
        run: mvn package -DskipTests

      # Paso 7: Subir el JAR como artefacto
      - name: ðŸ“¤ Subir JAR
        uses: actions/upload-artifact@v4
        with:
          name: calculadora-jar-${{ matrix.java-version }}
          path: target/*.jar
          retention-days: 5

      # Paso 8: Mensaje de Ã©xito
      - name: âœ… Build exitoso
        if: success()
        run: |
          echo "âœ… Â¡Todos los tests pasaron correctamente con Java ${{ matrix.java-version }}!"
          echo "ðŸ“¦ Artefacto JAR generado y disponible como artefacto en Actions."
